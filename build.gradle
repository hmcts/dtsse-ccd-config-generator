tasks.register('check') {
    gradle.includedBuilds.each { included ->
        dependsOn(included.task(':check'))
    }
}

afterEvaluate {
    subprojects.each { subproject ->
        if (subproject.tasks.findByName('check')) {
            tasks.check.dependsOn subproject.tasks.check
        }
    }
}
